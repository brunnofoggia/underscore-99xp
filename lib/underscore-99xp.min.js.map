{"version":3,"file":"underscore-99xp.min.js","sources":["../src/underscore-99xp.js"],"sourcesContent":["// [Underscore-99xp](https://github.com/brunnofoggia/underscore-99xp) is an\n// extension based on experience of [Underscore](https://underscorejs.org/).\n// It provides configuration for rendering templates, new methods to do\n// complex work and string helpers not included on Underscore.\n\n\n// Baseline setup\n// --------------\nimport _ from 'underscore';\nimport _s from 'underscore.string';\n\n\n// Renderer - The common way\n// --------------\n\n// Template Rendering like Angular / Vue\n\n//     /* Samples */\n//     {{ my_variable }}\n//     {% if(true) { %} test {% } %}\n_.templateSettings = {\n    interpolate: /\\{\\{(.+?)\\}\\}/g,\n    evaluate: /\\{\\%(.+?)\\%\\}/g,\n    escape: /\\{-([\\s\\S]+?)-\\}/g\n};\n\n// Objects - Advanced helpers\n// --------------\n\n// Traverses the children of obj along path.\n// If a child is a function, it is invoked with given context and arguments.\n// Returns the value of the final child, or fallback if any child is undefined.\n_.result2 = function (obj, key, defaultValue, args, context) {\n    var v;\n    if (!args && !context) {\n        v = _.result(obj, key, defaultValue);\n    } else {\n        switch (typeof obj[key]) {\n            case 'function':\n                var fn = obj[key];\n                if (context) {\n                    fn = _.bind(fn, context);\n                }\n                if (args) {\n                    fn = _.partial(_.partial, fn).apply(null, args);\n                }\n\n                v = fn() || defaultValue;\n                break;\n            case 'object':\n                v = obj[key] || defaultValue;\n                break;\n            default:\n                v = defaultValue;\n        }\n    }\n\n    return v;\n}\n\n// Fill in a given object with default properties.\n// The object of this 2nd version is to work with not plain objects\n_.defaults2 = function (o, d) {\n    var k1 = [],\n            k2 = [];\n    var kd1 = [],\n            kd2 = [];\n\n    _.map(o, (i, k) => _.isJSON(i) ? k2.push(k) : k1.push(k));\n    _.map(d, (i, k) => _.isJSON(i) ? kd2.push(k) : kd1.push(k));\n\n    var o1 = _.partial(_.pick, o).apply(null, k1),\n            o2 = _.partial(_.pick, o).apply(null, k2);\n    var od1 = _.partial(_.pick, d).apply(null, kd1),\n            od2 = _.partial(_.pick, d).apply(null, kd2);\n\n    o1 = _.defaults(o1, od1);\n    if (_.size(o2)) {\n        _.map(o2, (i, k) => {\n            o2[k] = _.defaults2(o2[k], od2[k] || {})\n        });\n    }\n    o1 = _.extend(o1, o2);\n\n    return o1;\n};\n\n\n// Locate values into an object as the samples below\n\n//     /* Samples */\n//     var json = {name: '99xp', contacts: [ {email: 'team@99xp.org'} , {email: 'admin@99xp.org'} ]};\n//     \n//     _.deepValueSearch('name', json) = 99xp\n//     _.deepValueSearch('contacts[0][email]', json) = team@99xp.org\n//     _.deepValueSearch('contacts[][email]', json) = [team@99xp.org, admin@99xp.org]\n//     _.deepValueSearch('contacts', json) = [ {email: 'team@99xp.org'} , {email: 'admin@99xp.org'} ]\n//     _.deepValueSearch('contacts[]', json) = [ {email: 'team@99xp.org'} , {email: 'admin@99xp.org'} ]\n\n_.deepValueSearch = function (k, json) {\n    var p = typeof k === 'string' && k ? k.split(/\\[/) : ((k instanceof Array) ? k : []);\n\n    if (!p.length) {\n        return json;\n    }\n    var pk = p.shift();\n\n    if (/^(\\w|\\_|\\-)+$/.test(pk)) {\n        return this.deepValueSearch(p, json[pk]);\n    }\n    if (pk === ']') {\n        if (!p.length) {\n            return json;\n        }\n        if ((json instanceof Array)) {\n            var r = [];\n            for (let x in json) {\n                r.push(this.deepValueSearch(_.clone(p), _.clone(json[x])));\n            }\n            return r;\n        }\n    }\n    if (/(\\w|\\_|\\-)+\\]$/.test(pk)) {\n        pk = pk.replace(']', '');\n        if (!p.length) {\n            return json[pk];\n        }\n        return !json ? json : this.deepValueSearch(p, json[pk]);\n    }\n}\n\n// Checks if given object is not an array\n_.isOnlyObject = function (o) {\n    return _.isObject(o) && !_.isArray(o);\n};\n\n// Checks if given object is pure js object, not instance of any class\n_.isJSON = function (o) {\n    return _.isOnlyObject(o) && o.__proto__.__proto__ === null;\n}\n\n\n// String Helpers\n// --------------\n\n// Capture all occurrences in a string\n_.matchAll = function (s, regexp) {\n    var matches = [];\n    s.replace(regexp, function () {\n        var arr = ([]).slice.call(arguments, 0);\n        var extras = arr.splice(-2);\n        arr.index = extras[0];\n        arr.input = extras[1];\n        matches.push(arr);\n    });\n    return matches.length ? matches : null;\n};\n\n// Locate index of something into a string based on regexp\n_.regexIndexOf = function (s, regex, startpos) {\n    var indexOf = s.substring(startpos || 0).search(regex);\n    return (indexOf >= 0) ? (indexOf + (startpos || 0)) : indexOf;\n};\n\n// Locate last index of something into a string based on regexp\n_.regexLastIndexOf = function (s, regex, ignoreAfterPos) {\n    regex = (regex.global) ? regex :\n            new RegExp(regex.source, 'g' + (regex.ignoreCase ? 'i' : '') + (regex.multiLine ? 'm' : ''));\n\n    if (typeof (ignoreAfterPos) === 'undefined') {\n        ignoreAfterPos = s.length;\n    } else if (ignoreAfterPos < 0) {\n        ignoreAfterPos = 0;\n    }\n    var stringToWorkWith = s.substring(0, ignoreAfterPos + 1);\n    var lastIndexOf = -1;\n    var nextStop = 0;\n    var result;\n    while ((result = regex.exec(stringToWorkWith)) != null) {\n        lastIndexOf = result.index;\n        regex.lastIndex = ++nextStop;\n    }\n    return lastIndexOf;\n};\n\n// Transform string into date\n_.toDate = function (s) {\n    if (!/^\\d{4}\\-\\d{2}/.test(s)) {\n        return false;\n    }\n\n    var data = s.toString().split(_.regexIndexOf(s.toString(), /T/) > 0 ? 'T' : ' '),\n            dateStr = data[0].split('-'),\n            timeStr = data[1] ? data[1].split(':') : [0, 0, 0],\n            date;\n\n    date = new Date(dateStr[0], parseInt(dateStr[1] || 0, 10) - 1, parseInt(dateStr[2] || 1, 10), timeStr[0] || 0, timeStr[1] || 0, timeStr[2] || 0);\n    return date;\n};\n\n_.defaultPorts = {\n    'http': 80,\n    'https': 443,\n    'ftp': 21,\n};\n\n// get parts of a URL\n_.parseUrl = function(u) {\n    const regex = /^((http[s]?|ftp):\\/)?\\/?([^:\\/\\s]+)(:([^\\/]*))?(((\\/\\w+)*\\/)([\\w\\-\\.]+[^#?\\s]+)(\\?([^#]*))?(#(.*))?)$/gm;\n    var m = regex.exec(u);\n\n    if (m) {\n        return {\n            schema: m[2],\n            hostname: m[3],\n            port: m[5] || _.defaultPorts[m[2]],\n            path: m[6] || '',\n        };\n    }\n};\n\n// Add all string helpers from [underscore.string](https://github.com/esamattis/underscore.string) library\n_.mixin(_s.exports());\n\nexport default _;\n"],"names":["_","templateSettings","interpolate","evaluate","escape","result2","obj","key","defaultValue","args","context","v","fn","bind","partial","apply","result","defaults2","o","d","k1","k2","kd1","kd2","map","i","k","isJSON","push","o1","pick","o2","od1","od2","defaults","size","extend","deepValueSearch","json","p","split","Array","length","pk","shift","test","this","r","x","clone","replace","isOnlyObject","isObject","isArray","__proto__","matchAll","s","regexp","matches","arr","slice","call","arguments","extras","splice","index","input","regexIndexOf","regex","startpos","indexOf","substring","search","regexLastIndexOf","ignoreAfterPos","global","RegExp","source","ignoreCase","multiLine","stringToWorkWith","lastIndexOf","nextStop","exec","lastIndex","toDate","data","toString","dateStr","timeStr","Date","parseInt","defaultPorts","parseUrl","u","m","schema","hostname","port","path","mixin","_s","exports"],"mappings":"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"}