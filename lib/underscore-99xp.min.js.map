{"version":3,"file":"underscore-99xp.min.js","sources":["../src/underscore-99xp.js"],"sourcesContent":["// [Underscore-99xp](https://github.com/brunnofoggia/underscore-99xp) is an\n// extension based on experience of [Underscore](https://underscorejs.org/).\n// It provides configuration for rendering templates, new methods to do\n// complex work and string helpers not included on Underscore.\n\n\n// Baseline setup\n// --------------\nimport _ from 'underscore';\nimport _s from 'underscore.string';\n\n\n// Renderer - The common way\n// --------------\n\n// Template Rendering like Angular / Vue\n\n//     /* Samples */\n//     {{ my_variable }}\n//     {% if(true) { %} test {% } %}\n_.templateSettings = {\n    interpolate: /\\{\\{(.+?)\\}\\}/g,\n    evaluate: /\\{\\%(.+?)\\%\\}/g,\n    escape: /\\{-([\\s\\S]+?)-\\}/g\n};\n\n// Objects - Advanced helpers\n// --------------\n\n// Traverses the children of obj along path.\n// If a child is a function, it is invoked with given context and arguments.\n// Returns the value of the final child, or fallback if any child is undefined.\n_.result2 = function(obj, key, defaultValue, args, context) {\n    var v;\n    if (!obj || !_.isObject(obj) || (!args && !context) || typeof obj[key] !== 'function') {\n        v = _.result(obj, key, defaultValue);\n    } else {\n        var fn = obj[key];\n        if (context) {\n            fn = _.bind(fn, context);\n        }\n        if (args) {\n            fn = _.partial(_.partial, fn).apply(null, args);\n        }\n\n        v = fn() || defaultValue;\n    }\n\n    return v;\n};\n\n// Fill in a given object with default properties.\n// The object of this 2nd version is to work with not plain objects\n_.defaults2 = function(o, d) {\n    var k1 = [],\n        k2 = [];\n    var kd1 = [],\n        kd2 = [];\n\n    _.map(o, function(i, k) {\n        return _.isJSON(i) || _.isArray(i) ? k2.push(k) : k1.push(k);\n    });\n\n    _.map(d, function(i, k) {\n        return _.isJSON(i) || _.isArray(i) ? kd2.push(k) : kd1.push(k);\n    });\n\n    var o1 = _.partial(_.pick, o).apply(null, k1),\n        o2 = _.partial(_.pick, o).apply(null, k2);\n\n    var od1 = _.partial(_.pick, d).apply(null, kd1),\n        od2 = _.partial(_.pick, d).apply(null, kd2);\n\n    o1 = _.defaults(o1, od1);\n\n    var keys = [],\n        or2 = _.clone(o2);\n    if (_.size(od2)) {\n        _.map(od2, function(i, k) {\n            if (_.indexOf(keys, k) !== -1) {\n                return;\n            }\n            keys.push(k);\n            var r = _.defaults2(o2[k] || {}, od2[k]);\n\n            or2[k] = r;\n        });\n    }\n    if (_.size(o2)) {\n        _.map(o2, function(i, k) {\n            if (_.indexOf(keys, k) !== -1) {\n                return;\n            }\n            keys.push(k);\n            var r = _.defaults2(o2[k], od2[k] || {});\n\n            or2[k] = r;\n        });\n    }\n\n    o1 = _.extend(o1, or2);\n    return o1;\n};\n\n\n// Locate values into an object as the samples below\n\n//     /* Samples */\n//     var json = {name: '99xp', contacts: [ {email: 'team@99xp.org'} , {email: 'admin@99xp.org'} ]};\n//     \n//     _.deepValueSearch('name', json) = 99xp\n//     _.deepValueSearch('contacts[0][email]', json) = team@99xp.org\n//     _.deepValueSearch('contacts[][email]', json) = [team@99xp.org, admin@99xp.org]\n//     _.deepValueSearch('contacts', json) = [ {email: 'team@99xp.org'} , {email: 'admin@99xp.org'} ]\n//     _.deepValueSearch('contacts[]', json) = [ {email: 'team@99xp.org'} , {email: 'admin@99xp.org'} ]\n\n_.deepValueSearch = function(k, json) {\n    var p = typeof k === 'string' && k ? k.split(/\\[/) : k instanceof Array ? k : [];\n\n    if (!p.length) {\n        return json;\n    }\n\n    var pk = p.shift();\n\n    if (/^(\\w|\\_|\\-)+$/.test(pk)) {\n        return this.deepValueSearch(p, json[pk]);\n    }\n\n    if (pk === ']') {\n        if (!p.length) {\n            return json;\n        }\n\n        if (json instanceof Array || _.isJSON(json)) {\n            var r = _.isJSON(json) ? {} : [];\n\n            for (var x in json) {\n                if (_.isJSON(r)) {\n                    r[x] = (this.deepValueSearch(_.clone(p), _.clone(json[x])));\n                } else {\n                    r.push(this.deepValueSearch(_.clone(p), _.clone(json[x])));\n                }\n            }\n\n            return r;\n        }\n    }\n\n    if (/(\\w|\\_|\\-)+\\]$/.test(pk)) {\n        pk = pk.replace(']', '');\n\n        if (!p.length) {\n            return json[pk];\n        }\n\n        return !json ? json : this.deepValueSearch(p, json[pk]);\n    }\n};\n\nvar createFieldStack = function(k, o, r = {}) {\n    if (o && typeof o === 'object') {\n        for (var x in o) {\n            var str2 = k + '[' + x + ']';\n\n            if (typeof o[x] === 'object') {\n                createFieldStack(str2, o[x], r);\n            } else {\n                r[str2] = o[x];\n            }\n        }\n    } else {\n        r[k] = o;\n    }\n\n    return r;\n}\n\n// Convert complex json into form data\n\n//     /* Samples */\n//     var json = {name: '99xp', contacts: [ {email: 'team@99xp.org'} , {email: 'admin@99xp.org'} ]};\n//     \n//     _.jsonToHTMLForm(json) = {\n//         name: '99xp',\n//         'contacts[0][email]': 'team@99xp.org',\n//         'contacts[1][email]': 'admin@99xp.org'\n//      }\n\n_.jsonToHTMLForm = function(json) {\n    if (!_.isJSON(json)) {\n        return false;\n    }\n\n    var r = {};\n    if (_.size(json)) {\n        for (var x in json) {\n            r = createFieldStack(x, json[x], r);\n        }\n    }\n\n    return r;\n}\n\n// Locate keys into an object as the samples below\n\n//     /* Samples */\n//     var json = {name: '99xp', contacts: [ {email: 'team@99xp.org'} , {email: 'admin@99xp.org'} ]};\n//     \n//     _.deepValueSearch('name', json) = [name]\n//     _.deepValueSearch('contacts[][email]', json) = [contacts[0][email], contacts[1][email]]\n\n_.deepKeySearch = function(k, j) {\n    var o = _.jsonToHTMLForm(j),\n        r = [];\n    if (o) {\n        r = _.filter(_.keys(o), (x) => {\n            var rxp = new RegExp('^' + k.replace(/\\[\\]/, '[\\\\d+]').replace(/(\\[|\\])/g, '\\\\$1'), 'g');\n            return rxp.test(x);\n        });\n    }\n\n    return r;\n};\n\n// Checks if given object is not an array\n_.isOnlyObject = function(o) {\n    return _.isObject(o) && !_.isArray(o);\n};\n\n// Checks if given object is pure js object, not instance of any class\n_.isJSON = function(o) {\n    return _.isOnlyObject(o) && o.__proto__.__proto__ === null;\n}\n\n\n// String Helpers\n// --------------\n\n// Capture all occurrences in a string\n_.matchAll = function(s, regexp) {\n    var matches = [];\n    s.replace(regexp, function() {\n        var arr = ([]).slice.call(arguments, 0);\n        var extras = arr.splice(-2);\n        arr.index = extras[0];\n        arr.input = extras[1];\n        matches.push(arr);\n    });\n    return matches.length ? matches : null;\n};\n\n// Locate index of something into a string based on regexp\n_.regexIndexOf = function(s, regex, startpos) {\n    var indexOf = s.substring(startpos || 0).search(regex);\n    return (indexOf >= 0) ? (indexOf + (startpos || 0)) : indexOf;\n};\n\n// Locate last index of something into a string based on regexp\n_.regexLastIndexOf = function(s, regex, ignoreAfterPos) {\n    regex = (regex.global) ? regex :\n        new RegExp(regex.source, 'g' + (regex.ignoreCase ? 'i' : '') + (regex.multiLine ? 'm' : ''));\n\n    if (typeof ignoreAfterPos === 'undefined') {\n        ignoreAfterPos = s.length;\n    } else if (ignoreAfterPos < 0) {\n        ignoreAfterPos = 0;\n    }\n    var stringToWorkWith = s.substring(0, ignoreAfterPos + 1);\n    var lastIndexOf = -1;\n    var nextStop = 0;\n    var result;\n    while ((result = regex.exec(stringToWorkWith)) != null) {\n        lastIndexOf = result.index;\n        regex.lastIndex = ++nextStop;\n    }\n    return lastIndexOf;\n};\n\n// Transform string into date\n_.toDate = function(s) {\n    if (!/^\\d{4}\\-\\d{2}/.test(s)) {\n        return false;\n    }\n\n    var data = s.toString().split(_.regexIndexOf(s.toString(), /T/) > 0 ? 'T' : ' '),\n        dateStr = data[0].split('-'),\n        timeStr = data[1] ? data[1].split(':') : [0, 0, 0],\n        date;\n\n    date = new Date(dateStr[0], parseInt(dateStr[1] || 0, 10) - 1, parseInt(dateStr[2] || 1, 10), timeStr[0] || 0, timeStr[1] || 0, timeStr[2] || 0);\n    return date;\n};\n\n_.defaultPorts = {\n    'http': 80,\n    'https': 443,\n    'ftp': 21,\n};\n\n// get parts of a URL\n_.parseUrl = function(u) {\n    const regex = /^((http[s]?|ftp):\\/)?\\/?([^:\\/\\s]+)(:([^\\/]*))?(((\\/\\w+)*\\/)([\\w\\-\\.]+[^#?\\s]+)(\\?([^#]*))?(#(.*))?)$/gm;\n    var m = regex.exec(u);\n\n    if (m) {\n        return {\n            schema: m[2],\n            hostname: m[3],\n            port: m[5] || _.defaultPorts[m[2]],\n            path: m[6] || '',\n        };\n    }\n};\n\n// Add all string helpers from [underscore.string](https://github.com/esamattis/underscore.string) library\n_.mixin(_s.exports());\n\nexport default _;\n"],"names":["_","templateSettings","interpolate","evaluate","escape","result2","obj","key","defaultValue","args","context","v","isObject","fn","bind","partial","apply","result","defaults2","o","d","k1","k2","kd1","kd2","map","i","k","isJSON","isArray","push","o1","pick","o2","od1","od2","defaults","keys","or2","clone","size","indexOf","r","extend","deepValueSearch","json","p","split","Array","length","pk","shift","test","this","x","replace","createFieldStack","_typeof","str2","jsonToHTMLForm","deepKeySearch","j","filter","RegExp","isOnlyObject","__proto__","matchAll","s","regexp","matches","arr","slice","call","arguments","extras","splice","index","input","regexIndexOf","regex","startpos","substring","search","regexLastIndexOf","ignoreAfterPos","global","source","ignoreCase","multiLine","stringToWorkWith","lastIndexOf","nextStop","exec","lastIndex","toDate","data","toString","dateStr","timeStr","Date","parseInt","defaultPorts","parseUrl","u","m","schema","hostname","port","path","mixin","_s","exports"],"mappings":"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"}